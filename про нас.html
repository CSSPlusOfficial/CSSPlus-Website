<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ –Ω–∞—Å - –¶–°–°–ü–õ–Æ–°</title> <!-- –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –±—Ä–µ–Ω–¥—É -->
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <link rel="stylesheet" href="styles.css"> <!-- Link the main stylesheet -->
    <link rel="stylesheet" href="about.css">
    <link rel="stylesheet" href="services.css">
    <link rel="stylesheet" href="services-animations.css">  <!-- Link the about page specific stylesheet -->
    <!-- Geist font is loaded via @font-face in styles.css -->

    <!-- Mapbox GL JS CSS -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />

    <!-- Mapbox GL JS Script -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>

</head>
<body>
    <video id="apple-bg" style="display: none;" muted autoplay loop playsinline></video>
    <div id="ukraine-support-widget">
        <div class="icon-tooltip-wrapper">
            <div id="ukraine-icon" onclick="showSupportMessage()">
                <!-- SVG Heart Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="white">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
            </div>
            <div class="tooltip-text">
                <span class="text-yellow font-bold">–°–ª–∞–≤–∞</span> <!-- –ó –≤–µ–ª–∏–∫–æ—ó –ª—ñ—Ç–µ—Ä–∏ -->
                <span class="text-blue font-bold">–£–∫—Ä–∞—ó–Ω—ñ</span> <!-- –î–æ–¥–∞–Ω–æ –∑–Ω–∞–∫ –æ–∫–ª–∏–∫—É —ñ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤—ñ–¥–º—ñ–Ω–æ–∫ -->
            </div>
        </div>
    </div>
    <!-- Background Animation (from styles.css) -->
    <div class="el"></div>

    <!-- Scroll Progress Indicator (from styles.css) -->
    <div id="scroll-indicator"></div>

    <!-- Menu Icon (from styles.css) -->
    <div class="menu">
        <div></div>
        <div></div>
        <div></div>
    </div>

    <!-- Navigation Menu Layer 1 (Gradient Background) -->
    <nav class="main-nav"></nav>

    <!-- Navigation Menu Layer 2 (Text Links) - Adjusted to match other pages -->
    <nav class="text-nav">
         <div class="nav-content">
             <!-- Main Links -->
             <ul>
                <li data-stagger="1"><a href="–¥–æ–¥–æ–º—É.html">–¥–æ–¥–æ–º—É</a></li>
                    <li data-stagger="2"><a href="–ø–æ—Å–ª—É–≥–∏.html">–ø–æ—Å–ª—É–≥–∏</a></li>
                    <li data-stagger="3"><a href="–ø—Ä–æ –Ω–∞—Å.html">–ø—Ä–æ –Ω–∞—Å</a></li>
                    <li data-stagger="4"><a href="—Ü–∏—Ç–∞—Ç–∞.html">–æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü–∏—Ç–∞—Ç—É</a></li>
                    <li class="lang-item" data-stagger="5"><a href="index.html">English</a></li>
             </ul>

             <!-- Tagline -->
             <p class="nav-tagline" data-stagger="6">–°—Ç–≤–æ—Ä—é—î–º–æ —Ü–∏—Ñ—Ä–æ–≤—É –¥–æ—Å–∫–æ–Ω–∞–ª—ñ—Å—Ç—å.</p> <!-- –û–Ω–æ–≤–ª–µ–Ω–æ —Å–ª–æ–≥–∞–Ω –¥–ª—è —É–∑–≥–æ–¥–∂–µ–Ω–æ—Å—Ç—ñ -->

             <!-- Contact Info -->
             <ul class="nav-contact-info" data-stagger="7">
                <li><a href="mailto:contact@cssplus.us">contact@cssplus.us</a></li> <!-- Consistent contact -->
                <li><a href="tel:+12673941289">+1 (267) 394-1289</a></li> <!-- Consistent contact -->
             </ul>
         </div>
         <!-- Decorative Line -->
         <div class="nav-divider"></div>
    </nav>
    <!-- End Navigation -->


    <main id="about-page-content">

        <!-- About Hero Section -->
        <section id="services-header" class="animate-on-load">
            <h1>–ü—Ä–æ –Ω–∞—Å</h1>
            <p class="services-intro">–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ —ñ—Å—Ç–æ—Ä—ñ—é, —Ü—ñ–Ω–Ω–æ—Å—Ç—ñ —Ç–∞ –±–∞—á–µ–Ω–Ω—è CSSPLUS. –ú–∏ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ –ø—Ä–æ—Å—Ç–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏; –º–∏ ‚Äî –≤–∞—à—ñ –ø–∞—Ä—Ç–Ω–µ—Ä–∏ —É —Ü–∏—Ñ—Ä–æ–≤–∏—Ö —ñ–Ω–Ω–æ–≤–∞—Ü—ñ—è—Ö.</p> <!-- –ü–æ–∫—Ä–∞—â–µ–Ω–æ —Ç–µ–∫—Å—Ç, –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞–∑–≤—É –±—Ä–µ–Ω–¥—É -->
             
             <!-- Optional Scroll Down Hint -->
             
        </section>

        <div class="scroll-down-hint animate-on-load">
            <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><linearGradient id="arrowGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#c12dee;" /><stop offset="100%" style="stop-color:#4b69ec;" /></linearGradient></defs><polyline points="4,8 12,16 20,8" fill="none" stroke="url(#arrowGradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><linearGradient id="arrowGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#c12dee;" /><stop offset="100%" style="stop-color:#4b69ec;" /></linearGradient></defs><polyline points="4,8 12,16 20,8" fill="none" stroke="url(#arrowGradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><linearGradient id="arrowGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#c12dee;" /><stop offset="100%" style="stop-color:#4b69ec;" /></linearGradient></defs><polyline points="4,8 12,16 20,8" fill="none" stroke="url(#arrowGradient)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>

        <!-- Our Story Section -->
        <section id="our-story" class="content-section animate-on-load" data-delay="0.2s">
            <h2 class="gradient-text-heading">–ù–∞—à–∞ —ñ—Å—Ç–æ—Ä—ñ—è</h2>
            <p>–ó–∞—Å–Ω–æ–≤–∞–Ω–∞ —É —Ç—Ä–∞–≤–Ω—ñ 2025 —Ä–æ–∫—É, –∫–æ–º–ø–∞–Ω—ñ—è CSSPLUS –±—É–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –∑ —á—ñ—Ç–∫–æ—é –º—ñ—Å—ñ—î—é: —Ä–æ–∑—Ä–æ–±–ª—è—Ç–∏ –æ–¥–Ω—ñ –∑ –Ω–∞–π–∫—Ä–∞—â–∏—Ö –≤–µ–±—Å–∞–π—Ç—ñ–≤ –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ. –ó —Å–∏–ª—å–Ω–∏–º –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –¥–∏–∑–∞–π–Ω, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞ —ñ–Ω–Ω–æ–≤–∞—Ü—ñ—ó, CSSPLUS –ø—Ä–∞–≥–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —ñ–¥–µ—ó –Ω–∞ –≤—Ä–∞–∂–∞—é—á—ñ —Ü–∏—Ñ—Ä–æ–≤—ñ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ. –î–æ –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É –º–∏ –ø—ñ–¥—Ö–æ–¥–∏–º–æ —Ç–≤–æ—Ä—á–æ —Ç–∞ —Ç–æ—á–Ω–æ, –≥–∞—Ä–∞–Ω—Ç—É—é—á–∏, —â–æ –∫–æ–∂–µ–Ω –≤–µ–±—Å–∞–π—Ç –≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è —Ç–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∏–Ω—è—Ç–∫–æ–≤–∏–π –¥–æ—Å–≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.</p> <!-- –ü–æ–∫—Ä–∞—â–µ–Ω–æ —Ç–µ–∫—Å—Ç, –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞–∑–≤—É –±—Ä–µ–Ω–¥—É, "–ø—Ä–æ–µ–∫—Ç" –Ω–∞ "–ø—Ä–æ—î–∫—Ç" -->
            <p>–í –æ—Å–Ω–æ–≤—ñ CSSPLUS ‚Äî –≤–∏—Å–æ–∫–æ–∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π —Å—Ç—É–¥–µ–Ω—Ç-—Ä–æ–∑—Ä–æ–±–Ω–∏–∫ –∑ –±–∞–≥–∞—Ç–æ—Ä—ñ—á–Ω–∏–º –¥–æ—Å–≤—ñ–¥–æ–º —Ä–æ–±–æ—Ç–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ –º–æ–≤–∞–º–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è —Ç–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—è–º–∏. –ú–∞—é—á–∏ –≥–ª–∏–±–æ–∫–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫–µ –∫–æ—Ä—ñ–Ω–Ω—è, –∑–∞—Å–Ω–æ–≤–Ω–∏–∫ –ø—Ä–∏–≤–Ω–æ—Å–∏—Ç—å —É –∫–æ–∂–µ–Ω –ø—Ä–æ—î–∫—Ç —É–Ω—ñ–∫–∞–ª—å–Ω–µ –ø–æ—î–¥–Ω–∞–Ω–Ω—è —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó –µ–∫—Å–ø–µ—Ä—Ç–∏–∑–∏ —Ç–∞ –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è. –¶–µ–π –¥–æ—Å–≤—ñ–¥ –∂–∏–≤–∏—Ç—å –ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç—å –¥–æ –¥–æ—Å–∫–æ–Ω–∞–ª–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–∞–≥–Ω–µ–Ω–Ω—è –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –±—ñ–∑–Ω–µ—Å—É —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –æ—Å–æ–±–∞–º –ø–æ–∫—Ä–∞—â—É–≤–∞—Ç–∏ —Å–≤–æ—é –æ–Ω–ª–∞–π–Ω-–ø—Ä–∏—Å—É—Ç–Ω—ñ—Å—Ç—å.</p> <!-- –ü–æ–∫—Ä–∞—â–µ–Ω–æ —Ç–µ–∫—Å—Ç, –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞–∑–≤—É –±—Ä–µ–Ω–¥—É, "–ø—Ä–æ–µ–∫—Ç" –Ω–∞ "–ø—Ä–æ—î–∫—Ç" -->
        </section>

        <!-- MOVED Mapbox Section -->
        <!-- ADDED id="mapbox-section" here for the IntersectionObserver -->
        <section id="mapbox-section" class="content-section animate-on-load" data-delay="0.4s">
            <h2 class="gradient-text-heading">–ó–Ω–∞–π–¥—ñ—Ç—å –Ω–∞—Å</h2>
            <p>–•–æ—á–∞ –Ω–∞—à–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–∞, –Ω–∞—à–µ –∫–æ—Ä—ñ–Ω–Ω—è —Ç—É—Ç. –ú–∏ –∑–Ω–∞—Ö–æ–¥–∏–º–æ—Å—è –≤ —ñ—Å—Ç–æ—Ä–∏—á–Ω–æ–º—É –º—ñ—Å—Ç–µ—á–∫—É –í–∞—à–∏–Ω–≥—Ç–æ–Ω –ö—Ä–æ—Å—Å—ñ–Ω–≥.</p>
            <div id="map-container">
                <!-- –ü–µ—Ä–µ–∫–ª–∞–¥–µ–Ω–æ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ -->
                <button id="explore-map-button" class="explore-map-btn">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–∞—Ä—Ç—É</button>
            </div>
            <!-- You can add address details here if needed -->
            <!-- <p style="margin-top: 1.5rem;">1 River Road, Washington Crossing, PA 18977</p> -->
        </section>

        <!-- Our Values Section -->
        <section id="our-values" class="content-section animate-on-load" data-delay="0.6s"> <!-- Adjusted delay -->
            <h2 class="gradient-text-heading">–û—Å–Ω–æ–≤–Ω—ñ —Ü—ñ–Ω–Ω–æ—Å—Ç—ñ</h2>
            <div class="values-grid">
                <div class="value-card">
                    <div class="value-icon">üí°</div>
                    <h3>–Ü–Ω–Ω–æ–≤–∞—Ü—ñ—ó</h3>
                    <p>–ü–æ—Å—Ç—ñ–π–Ω–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π —Ç–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–∏—Ö —Ä—ñ—à–µ–Ω—å.</p>
                </div>
                <div class="value-card">
                    <div class="value-icon">ü§ù</div>
                    <h3>–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ</h3>
                    <p>–ü–æ–±—É–¥–æ–≤–∞ –º—ñ—Ü–Ω–∏—Ö, —Å–ø—ñ–ª—å–Ω–∏—Ö –≤—ñ–¥–Ω–æ—Å–∏–Ω –∑ –Ω–∞—à–∏–º–∏ –∫–ª—ñ—î–Ω—Ç–∞–º–∏.</p>
                </div>
                <div class="value-card">
                    <div class="value-icon">‚≠ê</div>
                    <h3>–Ø–∫—ñ—Å—Ç—å</h3>
                    <p>–ù–∞–¥–∞–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–∏—Ö, —Å—Ç–∞–±—ñ–ª—å–Ω–∏—Ö —Ç–∞ –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏—Ö —Ä—ñ—à–µ–Ω—å.</p>
                </div>
                 <div class="value-card">
                    <div class="value-icon">üìà</div>
                    <h3>–ß–µ—Å–Ω—ñ—Å—Ç—å</h3> <!-- "–ß–µ—Å–Ω—ñ—Å—Ç—å" –∫—Ä–∞—â–µ –ø–µ—Ä–µ–¥–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è Integrity -->
                    <p>–î—ñ—è–ª—å–Ω—ñ—Å—Ç—å –∑ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—é, —á–µ—Å–Ω—ñ—Å—Ç—é —Ç–∞ –µ—Ç–∏—á–Ω–∏–º–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏.</p>
                </div>
            </div>
        </section>

        <!-- Optional CTA Section -->
        <section id="about-cta" class="animate-on-load" data-delay="0.8s"> <!-- Adjusted delay -->
             <h2>–ì–æ—Ç–æ–≤—ñ –¥–æ —Å–ø—ñ–ª—å–Ω–∏—Ö —ñ–Ω–Ω–æ–≤–∞—Ü—ñ–π?</h2>
             <p>–î–∞–≤–∞–π—Ç–µ –æ–±–≥–æ–≤–æ—Ä–∏–º–æ, —è–∫ CSSPLUS –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –≤–∞—à –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø—Ä–æ—î–∫—Ç.</p> <!-- –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞–∑–≤—É –±—Ä–µ–Ω–¥—É, "–ø—Ä–æ–µ–∫—Ç" –Ω–∞ "–ø—Ä–æ—î–∫—Ç", –ø–æ–∫—Ä–∞—â–µ–Ω–æ —Ç–µ–∫—Å—Ç -->
             <a href="—Ü–∏—Ç–∞—Ç–∞.html" class="cta-button">
                 –û—Ç—Ä–∏–º–∞—Ç–∏ —Ü—ñ–Ω–æ–≤—É –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é <span class="arrow-icon">‚Üí</span>
             </a>
        </section>

    </main>

    <!-- Footer (Consistent with other pages) -->
    <footer>
        <div class="footer-content">
            <hr class="footer-divider">
            <p>&copy; <span id="current-year"></span> CSSPLUS. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω–æ.</p> <!-- –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –±—Ä–µ–Ω–¥—É -->
        </div>
    </footer>
    <!-- === Footer End === -->

    <!-- JavaScript Section -->
    <script>
        // --- Basic JS (Menu, Year, Scroll Indicator) ---
        const menu = document.querySelector('.menu');
        const mainNav = document.querySelector('.main-nav');
        const textNav = document.querySelector('.text-nav');
        const body = document.body;
        const navLinks = document.querySelectorAll('.text-nav a'); // Get all nav links

        menu.addEventListener('click', () => {
            menu.classList.toggle('active');
            mainNav.classList.toggle('is-open');
            textNav.classList.toggle('is-open');
            body.classList.toggle('menu-open'); // Toggle class on body
        });

        // Close menu when a link is clicked
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (body.classList.contains('menu-open')) {
                    menu.classList.remove('active');
                    mainNav.classList.remove('is-open');
                    textNav.classList.remove('is-open');
                    body.classList.remove('menu-open');
                }
            });
        });

        // Footer Year
        const currentYearSpan = document.getElementById('current-year');
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        // Scroll Indicator
        const scrollIndicator = document.getElementById('scroll-indicator');
        const updateScrollIndicator = () => {
            const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
            const scrollableHeight = scrollHeight - clientHeight;
            const scrollPercent = scrollableHeight > 0 ? (scrollTop / scrollableHeight) * 100 : 0;
            if (scrollIndicator) {
                scrollIndicator.style.width = `${scrollPercent}%`;
            }
        };
        window.addEventListener('scroll', updateScrollIndicator);
        updateScrollIndicator(); // Initial call

        // Scroll Down Hint Fade Out
        const scrollHint = document.querySelector('.scroll-down-hint');
        if (scrollHint) {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) { // Adjust scroll distance as needed
                    scrollHint.classList.add('fade-out');
                }
            }, { passive: true });
        }
        // --- End Basic JS ---


        // --- Mapbox and Animation Logic ---
        const mapContainer = document.getElementById('map-container');
        let map = null; // Keep map instance accessible
        let mapAnimationTriggered = false; // Flag to ensure animation runs only once
        let mapReady = false; // Flag to check if style.load has finished

        // --- Mapbox Setup ---
        if (mapContainer) {
            mapboxgl.accessToken = 'pk.eyJ1IjoiZzQ0MjQ0NDAiLCJhIjoiY205eWxhZGtnMWxkcTJrcHJ4ZWhzeHQ0diJ9.oAai3B7fDDKnD_1pK_g91A'; // Your token

            // Coordinates
            const finalCoords = [-74.87064, 40.29375]; // Washington Crossing, PA (40¬∞17'37.5"N 74¬∞52'14.3"W)
            const nycCoords = [-74.0060, 40.7128]; // New York City

            let isSpinning = false;
            let animationFrameId = null;

            // Token Check (same as before)
            const placeholderToken = 'YOUR_MAPBOX_ACCESS_TOKEN';
            const exampleToken = 'pk.eyJ1IjoiZzQ0MjQ0NDAiLCJhIjoiY205eWxhZGtnMWxkcTJrcHJ4ZWhzeHQ0diJ9.oAai3B7fDDKnD_1pK_g91A';
            if (!mapboxgl.accessToken || mapboxgl.accessToken === placeholderToken) {
                 console.warn("Mapbox token missing or placeholder.");
                 if (mapboxgl.accessToken === placeholderToken) { mapContainer.innerHTML = '<p style="color: orange; text-align: center; padding-top: 40%;">Please add Mapbox Token</p>'; }
            } else if (mapboxgl.accessToken === exampleToken) { console.info("Using example Mapbox token."); }

            try {
                map = new mapboxgl.Map({ // Assign to the global 'map' variable
                    container: 'map-container',
                    style: 'mapbox://styles/mapbox/dark-v11',
                    center: finalCoords, // Start centered near final destination (but zoomed out)
                    zoom: 1.0,           // Start even more zoomed out
                    pitch: 0,
                    bearing: 0,
                    projection: 'globe', // –ó–∞–ª–∏—à–µ–Ω–æ 'globe'
                    antialias: true,
                    language: 'uk'
                });

                 map.on('style.load', () => {
                    console.log("Map style loaded.");
                    mapReady = true; // Set flag indicating map is ready for animations

                    map.setFog({ // Add atmospheric fog effect
                        color: 'rgb(30, 30, 35)', // Dark fog color matching background
                        'high-color': 'rgb(30, 30, 35)',
                        'horizon-blend': 0.02, // Subtle blend
                        'space-color': 'rgb(10, 10, 15)', // Dark space color
                        'star-intensity': 0.15 // Subtle stars
                    });

                    // --- 3D Buildings Layer with Adjusted Zoom ---
                    const layers = map.getStyle().layers;
                    const labelLayerId = layers.find(l => l.type === 'symbol' && l.layout?.['text-field'])?.id;
                    if (labelLayerId) {
                        map.addLayer({
                            'id': 'add-3d-buildings',
                            'source': 'composite',
                            'source-layer': 'building',
                            'filter': ['==', 'extrude', 'true'],
                            'type': 'fill-extrusion',
                            'minzoom': 12, // Buildings appear earlier
                            'paint': {
                                'fill-extrusion-color': '#aaa',
                                'fill-extrusion-height': ['interpolate',['linear'],['zoom'],12,0,13.5,['get','height']],
                                'fill-extrusion-base': ['interpolate',['linear'],['zoom'],12,0,13.5,['get','min_height']],
                                'fill-extrusion-opacity': 0.75
                            }
                        }, labelLayerId);
                    } else { console.warn("Could not find a symbol layer for 3D buildings."); }
                    // --- END 3D Buildings Layer ---

                    // Check if the map section was already visible when style loaded
                    if (mapAnimationTriggered) {
                        console.log("Map ready, animation already triggered by observer, starting sequence.");
                        executeMapAnimationSequence(); // Start animation if observer fired first
                    }

                    // --- Fade in Explore Button after delay ---
                    setTimeout(() => {
                        const exploreButton = document.getElementById('explore-map-button');
                        if (exploreButton) {
                            exploreButton.classList.add('visible'); // Use class for visibility/opacity
                            console.log("Explore map button faded in.");
                        }
                    }, 12000); // 13 seconds delay after style load
                 });

                 map.on('error', (e) => {
                    console.error('Mapbox GL Error:', e.error);
                    mapContainer.innerHTML = '<p style="color: #ff6b6b; text-align: center; padding-top: 40%; font-size: 0.9rem;">Error loading map. Check console and Mapbox token.</p>';
                 });

                // Add controls
                map.addControl(new mapboxgl.NavigationControl());
                map.addControl(new mapboxgl.FullscreenControl());

                // Add marker (at final destination)
                new mapboxgl.Marker({ color: '#c12dee' }).setLngLat(finalCoords).addTo(map);

                // --- Animation Functions (Spinning Logic) ---
                function spinGlobe() {
                    if (!isSpinning || !map) return;
                    const currentBearing = map.getBearing();
                    // Pivot around finalCoords
                    map.easeTo({ bearing: currentBearing + 0.1, duration: 0, around: finalCoords, essential: true });
                    animationFrameId = requestAnimationFrame(spinGlobe);
                }
                function startSpinning() {
                    if (isSpinning) return;
                    isSpinning = true;
                    animationFrameId = requestAnimationFrame(spinGlobe);
                    console.log("Map rotation started around final destination.");
                }
                function stopSpinning() {
                    if (!isSpinning) return;
                    isSpinning = false;
                    if (animationFrameId) { cancelAnimationFrame(animationFrameId); animationFrameId = null; }
                    console.log("Map rotation stopped.");
                }

                // Stop spinning on user interaction
                map.on('dragstart', stopSpinning);
                map.on('zoomstart', stopSpinning);
                map.on('pitchstart', stopSpinning);
                map.on('rotatestart', stopSpinning);

                // --- Function to Execute the Single-Stage Animation Sequence (To Washington Crossing) ---
                function executeMapAnimationSequence() {
                    if (!map) { console.error("Map object not available for animation."); return; }
                    console.log("Executing single-stage map animation sequence to Washington Crossing.");

                    // 1. Short delay (optional)
                    setTimeout(() => {
                        console.log("Flying to Washington Crossing...");
                        // 2. Fly directly to the final destination
                        map.flyTo({
                            center: finalCoords, // Washington Crossing Coords
                            zoom: 15.5,
                            pitch: 65,
                            bearing: -20,
                            duration: 10000, // 10 seconds flight time
                            essential: true
                        });

                        // 3. Start spinning *after* the flyTo animation finishes
                        map.once('moveend', (e) => {
                            if (e.essential) { // Ensure it's the end of our flyTo
                                console.log("Arrived at final destination. Starting spin.");
                                startSpinning();
                            }
                        });

                    }, 500); // Initial delay before flight
                }


                // --- Function called by Intersection Observer ---
                window.triggerMapAnimation = function() {
                    if (mapAnimationTriggered) return; // Don't run again
                    console.log("Map section intersected, triggering animation flag.");
                    mapAnimationTriggered = true;
                    if (mapReady) {
                         console.log("Map already ready, starting animation sequence now.");
                         executeMapAnimationSequence();
                    } else {
                         console.log("Map not ready yet, animation will start on style.load.");
                    }
                }

                // --- Explore Button Click Listener (Flies to NYC) ---
                const exploreButton = document.getElementById('explore-map-button');
                if (exploreButton && map) { // Ensure button and map exist
                    exploreButton.addEventListener('click', () => {
                        console.log("Explore map button clicked. Flying to NYC.");

                        // Stop any existing spinning animation
                        stopSpinning();
                        // Stop any ongoing flyTo animation (important if clicked during initial fly-in)
                        map.stop();

                        // Fly to NYC
                        map.flyTo({
                            center: nycCoords,
                            zoom: 15, // Zoom level for NYC
                            pitch: 60,  // Pitch for NYC
                            bearing: -15, // Bearing for NYC
                            duration: 8000, // Duration for flight to NYC
                            essential: true
                        });

                        // Fade out and disable button
                        exploreButton.classList.remove('visible'); // Use class for visibility/opacity
                        exploreButton.disabled = true; // Prevent multiple clicks

                        // Optional: Remove the button from DOM after fade out if desired
                        // setTimeout(() => {
                        //     exploreButton.remove();
                        // }, 600); // Match CSS transition duration

                    });
                } else if (!exploreButton) {
                    console.error("Explore map button not found!");
                }


            } catch (error) {
                 console.error("Failed to initialize Mapbox:", error);
                 mapContainer.innerHTML = '<p style="color: #ff6b6b; text-align: center; padding-top: 40%; font-size: 0.9rem;">Failed to initialize map. Check console.</p>';
            }

        } else {
            console.error("Map container (#map-container) not found.");
        }
        // --- End Mapbox Setup ---


        // --- Scroll Animations (Intersection Observer) ---
        const animatedElements = document.querySelectorAll('.animate-on-load');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const delay = entry.target.dataset.delay || '0s';
                    entry.target.style.transitionDelay = delay;
                    entry.target.classList.add('visible');
                    // Trigger map animation specifically when mapbox-section is visible
                    if (entry.target.id === 'mapbox-section') {
                        if (typeof window.triggerMapAnimation === 'function') {
                            window.triggerMapAnimation();
                        }
                    }
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 }); // Trigger when 10% visible
        animatedElements.forEach(el => { observer.observe(el); });
        // --- End Scroll Animations ---

    </script>

<script>
    const isiPhone = /iPhone/.test(navigator.userAgent);
  
    if (isiPhone) {
      const el = document.querySelector('.el');
      const video = document.getElementById('apple-bg');
  
      // Hide the original background
      if (el) el.style.display = 'none';
  
      // Show and style the video
      video.src = 'bg.mp4'; // Replace with your actual video file path
      video.style.display = 'block';
      video.style.position = 'fixed';
      video.style.top = '0';
      video.style.left = '0';
      video.style.width = '100vw';
      video.style.height = '100vh';
      video.style.objectFit = 'cover';
      video.style.zIndex = '-1';
      video.muted = true;
      video.playsInline = true;
      video.autoplay = true;
      video.loop = true;
    }
  </script>
  

</body>
</html>
